drop database bank_adm;

CREATE DATABASE IF NOT EXISTS bank_adm;
USE bank_adm;


CREATE TABLE Cliente (
    id_cliente INT PRIMARY KEY AUTO_INCREMENT,
    nome_cliente VARCHAR(100) NOT NULL,
    email_cliente VARCHAR(60) UNIQUE,
    cpf_cliente CHAR(11) NOT NULL UNIQUE,
    idade_cliente INT NOT NULL,
    datanas_cliente DATE NOT NULL
) ;

CREATE TABLE Loja (
    id_loja INT PRIMARY KEY AUTO_INCREMENT,
    cnpj_loja CHAR(14) NOT NULL UNIQUE,
    email_loja VARCHAR(100),
    nome VARCHAR(60) NOT NULL
) ;

CREATE TABLE FormaPagamento (
    id_formapagamento INT PRIMARY KEY AUTO_INCREMENT,
    tipo VARCHAR(18) NOT NULL,
    parcela INT
) ;

CREATE TABLE Delivery (
    id_delivery INT PRIMARY KEY AUTO_INCREMENT,
    frete_delivery DECIMAL(10,2) NOT NULL,
    codrastreio_delivery BIGINT NOT NULL UNIQUE,
    StTransporte_delivery VARCHAR(15)
) ;



CREATE TABLE Fornecedor (
    id_fornecedor INT PRIMARY KEY AUTO_INCREMENT,
    nome_fornecedor VARCHAR(70) NOT NULL,
    cnpj_fornecedor CHAR(14) UNIQUE,
    site VARCHAR(100)
) ;



CREATE TABLE Endereco (
    id_endereco INT PRIMARY KEY AUTO_INCREMENT,
    cep CHAR(8),
    rua VARCHAR(40) NOT NULL,
    numero VARCHAR(10) NOT NULL,
    bairro VARCHAR(40),
    cidade VARCHAR(40),
    sgestado CHAR(2)
) ;

CREATE TABLE Telefone (
    id_telefone INT PRIMARY KEY AUTO_INCREMENT,
    numero VARCHAR(20) NOT NULL  
) ;

CREATE TABLE Funcionario (
    id_funcionario INT PRIMARY KEY AUTO_INCREMENT,
    nome_funcionario VARCHAR(150) NOT NULL,
    idade_funcionario INT NOT NULL,
    cpf_funcionario CHAR(11) NOT NULL UNIQUE,
    rg_funcionario CHAR(20) NOT NULL UNIQUE,
    datanas_funcionario DATE NOT NULL,
    email_funcionario VARCHAR(100) UNIQUE,
    cargo_funcionario VARCHAR(30) NOT NULL,
    sexo_funcionario CHAR(1) NOT NULL,
    salario_funcionario DECIMAL(10,2) NOT NULL DEFAULT 1518.00,
    id_loja INT,
    CONSTRAINT ch_funcionario_sexo CHECK (sexo_funcionario IN ('f','m')),
    CONSTRAINT ch_funcionario_salario CHECK (salario_funcionario > 0),
    FOREIGN KEY (id_loja) REFERENCES Loja(id_loja) 
) ;

CREATE TABLE Produto (
    id_produto INT PRIMARY KEY AUTO_INCREMENT,
    tipo_produto VARCHAR(40) NOT NULL,
    nome_produto VARCHAR(80) NOT NULL,
    descricao_produto VARCHAR(200),
    preco_produto DECIMAL(10,2) NOT NULL,
    quantidade_produto INT NOT NULL,
    tamanho_produto DECIMAL(6,2),
    id_fornecedor INT,
    FOREIGN KEY (id_fornecedor) REFERENCES Fornecedor(id_fornecedor) 
) ;



CREATE TABLE Login(

id_login int primary key auto_increment,
id_funcionario int unique,
Usuario varchar(100) not null unique,
Senha varchar(50) not null,
FOREIGN KEY (id_funcionario) REFERENCES Funcionario(id_funcionario) 
);

CREATE TABLE LoginFunc(
    id_loginFunc INT PRIMARY KEY AUTO_INCREMENT,
    id_funcionario INT UNIQUE,
    Usuario_Fun VARCHAR(100) NOT NULL UNIQUE,
    Senha_Fun VARCHAR(50) NOT NULL,
    FOREIGN KEY (id_funcionario) REFERENCES Funcionario(id_funcionario)
);




CREATE TABLE Pedido (
    id_pedido INT PRIMARY KEY AUTO_INCREMENT,
    valor DECIMAL(10,2) NOT NULL,
    data_transacao datetime NOT NULL,
    hora_transacao TIME NOT NULL,
    id_cliente INT,
    id_loja INT,
    id_formapagamento INT not null,
    id_delivery INT,
    FOREIGN KEY (id_cliente) REFERENCES Cliente(id_cliente) ,
    FOREIGN KEY (id_loja) REFERENCES Loja(id_loja) ,
    FOREIGN KEY (id_formapagamento) REFERENCES FormaPagamento(id_formapagamento) ,
    FOREIGN KEY (id_delivery) REFERENCES Delivery(id_delivery) 
   
) ;


CREATE TABLE Cliente_has_Endereco (
    id_cliente INT,
    id_endereco INT,
    PRIMARY KEY (id_cliente, id_endereco),
    FOREIGN KEY (id_cliente) REFERENCES Cliente(id_cliente) ,
    FOREIGN KEY (id_endereco) REFERENCES Endereco(id_endereco) 
) ;

CREATE TABLE Loja_has_Endereco (
    id_loja INT,
    id_endereco INT,
    PRIMARY KEY (id_loja, id_endereco),
    FOREIGN KEY (id_loja) REFERENCES Loja(id_loja) ,
    FOREIGN KEY (id_endereco) REFERENCES Endereco(id_endereco) 
) ;

CREATE TABLE Endereco_has_Funcionarios (
    id_endereco INT,
    id_funcionario INT,
    PRIMARY KEY (id_endereco, id_funcionario),
    FOREIGN KEY (id_endereco) REFERENCES Endereco(id_endereco) ,
    FOREIGN KEY (id_funcionario) REFERENCES Funcionario(id_funcionario)
) ;

CREATE TABLE Endereco_has_Fornecedor (
    id_endereco INT,
    id_fornecedor INT,
    PRIMARY KEY (id_endereco, id_fornecedor),
    FOREIGN KEY (id_endereco) REFERENCES Endereco(id_endereco) ,
    FOREIGN KEY (id_fornecedor) REFERENCES Fornecedor(id_fornecedor) 
) ;

CREATE TABLE Telefone_has_Cliente (
    id_telefone INT,
    id_cliente INT,
    PRIMARY KEY (id_telefone, id_cliente),
    FOREIGN KEY (id_telefone) REFERENCES Telefone(id_telefone) ,
    FOREIGN KEY (id_cliente) REFERENCES Cliente(id_cliente) 
) ;

CREATE TABLE Telefone_has_Funcionarios (
    id_telefone INT,
    id_funcionario INT,
    PRIMARY KEY (id_telefone, id_funcionario),
    FOREIGN KEY (id_telefone) REFERENCES Telefone(id_telefone) ,
    FOREIGN KEY (id_funcionario) REFERENCES Funcionario(id_funcionario) 
) ;

CREATE TABLE Telefone_has_Fornecedor (
    id_telefone INT,
    id_fornecedor INT,
    PRIMARY KEY (id_telefone, id_fornecedor),
    FOREIGN KEY (id_telefone) REFERENCES Telefone(id_telefone) ,
    FOREIGN KEY (id_fornecedor) REFERENCES Fornecedor(id_fornecedor) 
) ;

CREATE TABLE Pedido_has_Produto (
    id_pedido INT,
    id_produto INT,
    quantidade INT NOT NULL,
    PRIMARY KEY (id_pedido, id_produto),
    FOREIGN KEY (id_pedido) REFERENCES Pedido(id_pedido) ,
    FOREIGN KEY (id_produto) REFERENCES Produto(id_produto) 
) ;


insert into Fornecedor (nome_fornecedor,site) values
('Holambelo Gran Flora','https://www.holambelo.com/pt/product/index/index/WPA_ID/7/'),
('feiradeflores','https://feiradeflores.com.br/' );

INSERT INTO Loja (cnpj_loja, email_loja, nome)
VALUES ('12345678000199', 'aliahcristina2017@gmail.com', 'Floricultura Floresol');

INSERT INTO Telefone (numero)
VALUES ('19992828650');
SET @idTel = LAST_INSERT_ID();
INSERT INTO Telefone_has_Fornecedor (id_telefone, id_fornecedor)
VALUES (@idTel, 1);





INSERT INTO Produto (nome_produto,tipo_produto,quantidade_produto,preco_produto) values
('Bromélias','Flor',4, 15.00),
('Girassol','Flor',10,15.00),
('Orquideas','Flor',20, 15.00),
('Lavanda','Flor',1,15.00),
('Tulipas','Flor',6, 15.00),
('Jasmim','Flor',7,15.00);


INSERT INTO Funcionario 
(nome_funcionario, idade_funcionario, cpf_funcionario, rg_funcionario, datanas_funcionario, 
 email_funcionario, cargo_funcionario, sexo_funcionario, salario_funcionario, id_loja)
VALUES
('Alana Barbosa do Patrocinio', 
 17, '11122233345', '45.123.456-7', '2008-04-07',
 'alana.patrocinio@gmail.com', 'Caixa', 'f', 1518.00, 1),

('Aliah Cristina Lourenço dos Reis', 
 17, '22233344456', '44.987.654-3', '2007-10-28',
 'aliah.reis@gmail.com', 'Marketing', 'f', 1518.00, 1),

('Amanda Aguiar Alves da Silva', 
 17, '33344455567', '42.567.890-1', '2007-12-23',
 'amanda.alves@gmail.com', 'Florista', 'f', 1518.00, 1),

('Guilhermina Souza Santana', 
 16, '44455566678', '48.456.321-9', '2008-05-12',
 'guilhermina.santana@gmail.com', 'Limpeza', 'f', 1518.00, 1),

('Maria Eduarda de Moura Alves', 
 17, '55566677789', '52.789.654-0', '2008-02-27',
 'maria.eduarda@gmail.com', 'Contabilidade e Finanças', 'f', 1518.00, 1),
 
 ('Desenvolvedores', 
 17, '33311100999', '23.456.789-6', '2008-01-29',
 'Desenvolve.Jeff01@Gmail.com', 'Coders', 'm', 9447.24, 1);
 
 INSERT INTO FormaPagamento (tipo, parcela) VALUES
('Débito', 1),
('Crédito', 2),
('Pix', NULL);

INSERT INTO Cliente (nome_cliente, email_cliente, cpf_cliente, idade_cliente, datanas_cliente) VALUES
('Cliente 1', 'c1@gmail.com', '11122233344', 30, '1995-01-01'),
('Cliente 2', 'c2@gmail.com', '22233344455', 25, '1999-02-10'),
('Cliente 3', 'c3@gmail.com', '33344455566', 28, '1996-03-20'),
('Cliente 4', 'c4@gmail.com', '44455566677', 22, '2002-07-15');
 
 INSERT INTO Delivery (frete_delivery, codrastreio_delivery, StTransporte_delivery) VALUES
(12.90, 987654321001, 'Postado'),
(9.50, 987654321002, 'Rota'),
(15.00, 987654321003, 'Entregue'),
(11.20, 987654321004, 'Rota'),
(10.00, 987654321005, 'Entregue');
 
 INSERT INTO Pedido (valor, data_transacao, hora_transacao, id_cliente, id_loja, id_formapagamento, id_delivery)
VALUES
(45.00, NOW(), NOW(), 1, 1, 1, 1),
(30.00,  NOW(), NOW(), 2, 1, 2, 2),
(60.00,  NOW(), NOW(), 3, 1, 3, 3),
(15.00,  NOW(), NOW(), 1, 1, 1, 1),
(75.00,  NOW(), NOW(), 4, 1, 2, 4),
(90.00,  NOW(), NOW(), 2, 1, 2, 5),
(15.00,  NOW(), NOW(), 3, 1, 3, 1),
(45.00,  NOW(), NOW(), 1, 1, 1, 3),
(30.00,  NOW(), NOW(), 4, 1, 3, 2),
(105.00, NOW(), NOW(), 3, 1, 2, 4);




 

INSERT INTO Pedido_has_Produto (id_pedido, id_produto, quantidade) VALUES
(1, 2, 1),
(1, 4, 1);

INSERT INTO Endereco (cep, rua, numero, bairro, cidade, sgestado)
VALUES
('13000000', 'Rua das Flores', '100', 'Centro', 'Campinas', 'SP'),
('14000000', 'Av. Brasil', '200', 'Jardim Paulista', 'Ribeirão Preto', 'SP'),
('15000000', 'Rua Primavera', '50', 'Vila Nova', 'São José do Rio Preto', 'SP'),
('16000000', 'Av. das Rosas', '300', 'Jardim Europa', 'Sorocaba', 'SP');


INSERT INTO Cliente_has_Endereco (id_cliente, id_endereco)
VALUES
(1, 1),
(2, 2),
(3, 3),
(4, 4);

INSERT INTO LoginFunc (id_funcionario, Usuario_Fun, Senha_Fun) VALUES
 (1, "Alana Barbosa", "07042008"),
 (2, "Aliah Cristina", "28102007"),
 (3, "Amanda Aguiar", "23122007"),
 (4, "Guilhermina Souza", "12052008"),
 (5, "Maria Eduarda", "27022008"),
 (6, "Desenvolvedores", "29012008");




select*from Pedido;
 select*from fornecedor;
 select*from Funcionario;
 select nome_produto,tipo_produto,quantidade_produto,preco_produto from produto;
 SELECT SUM(valor) FROM Pedido WHERE DATE(data_transacao) = CURDATE(); 
 
 
 SELECT 
    p.id_pedido,
    c.nome_cliente,
    pr.nome_produto,
    php.quantidade,
    pr.preco_produto,
    (php.quantidade * pr.preco_produto) AS total_item,
    p.valor AS total_pedido,
    p.data_transacao
FROM Pedido p
JOIN Cliente c ON p.id_cliente = c.id_cliente
JOIN Pedido_has_Produto php ON p.id_pedido = php.id_pedido
JOIN Produto pr ON php.id_produto = pr.id_produto
ORDER BY p.id_pedido;




SELECT 
    p.id_pedido,
    c.nome_cliente,
    pr.nome_produto,
    php.quantidade,
    e.rua,
    e.numero,
    e.bairro,
    e.cidade,
    e.sgestado,
    d.codrastreio_delivery AS codigo_rastreio,
    d.StTransporte_delivery AS status_entrega
FROM Pedido p
JOIN Cliente c ON p.id_cliente = c.id_cliente
JOIN Pedido_has_Produto php ON p.id_pedido = php.id_pedido
JOIN Produto pr ON php.id_produto = pr.id_produto
JOIN Delivery d ON p.id_delivery = d.id_delivery
JOIN Cliente_has_Endereco ce ON c.id_cliente = ce.id_cliente
JOIN Endereco e ON ce.id_endereco = e.id_endereco
ORDER BY p.id_pedido;
